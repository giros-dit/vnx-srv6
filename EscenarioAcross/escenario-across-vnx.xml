<?xml version="1.0" encoding="UTF-8"?>
<vnx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="/usr/share/xml/vnx/vnx-2.00.xsd">
  <global>
    <version>2.0</version>
    <scenario_name>ACROSSVNX</scenario_name>
    <automac/>
    <vm_mgmt type="none" />
    <vm_defaults>
        <console id="0" display="no"/>
        <console id="1" display="yes"/>
    </vm_defaults>
    
  </global>


  <net name="Net111" mode="virtual_bridge" />
  <net name="Net411" mode="virtual_bridge" />
  <net name="Net12" mode="virtual_bridge" />
  <net name="Net14" mode="virtual_bridge" />
  <net name="Net46" mode="virtual_bridge" />
  <net name="Net23" mode="virtual_bridge" />
  <net name="Net25" mode="virtual_bridge" />
  <net name="Net212" mode="virtual_bridge" />
  <net name="Net56" mode="virtual_bridge" />
  <net name="Net313" mode="virtual_bridge" />
  <net name="Net312" mode="virtual_bridge" />
  <net name="Net37" mode="virtual_bridge" />
  <net name="Net67" mode="virtual_bridge" />
  <net name="Net713" mode="virtual_bridge" />
  <net name="Net11gnb" mode="virtual_bridge" />
  <net name="NetgNBh1" mode="virtual_bridge" />
  <net name="NetgNBh2" mode="virtual_bridge" />
  <net name="NetgNBh3" mode="virtual_bridge" />
  <net name="Net13upf" mode="virtual_bridge" />
  <!--
  
  SISTEMAS FINALES

  -->
  <vm name="h1" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <mem>128M</mem>
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025</filesystem>
    <if id="1" net="NetgNBh1">
      <ipv6>fd00:0:1::2/64</ipv6>
    </if>
    <route type="ipv6" gw="fd00:0:1::1">default</route>   
  </vm>
<vm name="h2" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <mem>128M</mem>
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025</filesystem>
    <if id="1" net="NetgNB">
      <ipv6>fd00:0:1::3/64</ipv6>
    </if>
    <route type="ipv6" gw="fd00:0:1::1">default</route>  
  </vm>

  <vm name="h3" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <mem>128M</mem>
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025</filesystem>
    <if id="1" net="NetgNBh3">
      <ipv6>fd00:0:3::2/64</ipv6>
    </if>
    <route type="ipv6" gw="fd00:0:1::1">default</route>   
  </vm>

  <vm name="UPF" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <mem>128M</mem>
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025</filesystem>
    <if id="1" net="Net13upf">
      <ipv6>fd00:0:4::2/64</ipv6>
    </if>
    <route type="ipv6" gw="fd00:0:4::1">default</route>   
  </vm>

  <!--
  
  ROUTERS

  -->

  <vm name="r1" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:1::1/32</ipv6>
    </if>
    <if id="2" net="Net12">
      <ipv6>fcf0:0:1:2::1/64</ipv6>
    </if>
    <if id="3" net="Net14">
      <ipv6>fcf0:0:1:4::1/64</ipv6>
    </if>
    <if id="4" net="Net111">
      <ipv6>fcf0:0:1:11::1/64</ipv6>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r1/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r2" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:2::1/32</ipv6>
    </if>
    <if id="2" net="Net12">
      <ipv6>fcf0:0:1:2::2/64</ipv6>
    </if>
    <if id="3" net="Net23">
      <ipv6>fcf0:0:2:3::1/64</ipv6>
    </if>
    <if id="4" net="Net25">
      <ipv6>fcf0:0:2:5::1/64</ipv6>
    </if>
    <if id="5" net="Net212">
      <ipv6>fcf0:0:2:12::1/64</ipv6>
    </if>
    <forwarding type="ip" />
  <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r2/*</filetree>
  <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r3" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:3::1/32</ipv6>
    </if>
    <if id="2" net="Net23">
      <ipv6>fcf0:0:2:3::2/64</ipv6>
    </if>
    <if id="3" net="Net37">
      <ipv6>fcf0:0:3:7::1/64</ipv6>
    </if>
    <if id="4" net="Net312">
      <ipv6>fcf0:0:3:12::1/64</ipv6>
    </if>
    <if id="5" net="Net313">
      <ipv6>fcf0:0:3:13::1/64</ipv6>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r3/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r4" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:4::1/32</ipv6>
    </if>
    <if id="2" net="Net14">
      <ipv6>fcf0:0:1:4::2/64</ipv6>
    </if>
    <if id="3" net="Net46">
      <ipv6>fcf0:0:4:6::1/64</ipv6>
    </if>
    <if id="4" net="Net411">
      <ipv6>fcf0:0:4:11::1/64</ipv6>
    </if>

    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r4/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r5" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:5::1/32</ipv6>
    </if>
    <if id="2" net="Net25">
      <ipv6>fcf0:0:2:5::2/64</ipv6>
    </if>
    <if id="3" net="Net56">
      <ipv6>fcf0:0:5:6::1/64</ipv6>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r5/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r6" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:6::1/32</ipv6>
    </if>
    <if id="2" net="Net46">
      <ipv6>fcf0:0:4:6::2/64</ipv6>
    </if>
    <if id="3" net="Net56">
      <ipv6>fcf0:0:5:6::2/64</ipv6>
    </if>
    <if id="4" net="Net67">
      <ipv6>fcf0:0:6:7::1/64</ipv6>
    </if>
   
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r6/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r7" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:7::1/32</ipv6>
    </if>
    <if id="2" net="Net37">
      <ipv6>fcf0:0:3:7::2/64</ipv6>
    </if>
    <if id="3" net="Net67">
      <ipv6>fcf0:0:6:7::2/64</ipv6>
    </if>
    <if id="4" net="Net713">
      <ipv6>fcf0:0:7:13::1/64</ipv6>
    </if>
   
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r7/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r11" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:11::1/32</ipv6>
    </if>
    <if id="2" net="Net111">
      <ipv6>fcf0:0:1:11::2/64</ipv6>
    </if>
    <if id="3" net="Net411">
      <ipv6>fcf0:0:4:11::2/64</ipv6>
    </if>
    <if id="4" net="Net11gnb">
      <ipv6>fcf0:0:11:14::1/64</ipv6>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r11/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r12" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:12::1/32</ipv6>
    </if>
    <if id="2" net="Net212">
      <ipv6>fcf0:0:2:12::2/64</ipv6>
    </if>
    <if id="3" net="Net312">
      <ipv6>fcf0:0:3:12::2/64</ipv6>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r12/*</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
  </vm>

  <vm name="r13" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:13::1/32</ipv6>
    </if>
    <if id="2" net="Net313">
      <ipv6>fcf0:0:3:13::2/64</ipv6>
    </if>
    <if id="3" net="Net713">
      <ipv6>fcf0:0:7:13::2/64</ipv6>
    </if>
    <if id="4" net="Net13upf">
      <ipv6>fd00:0:4::1/64</ipv6>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/r13/*.conf</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf 
    </exec>
    <filetree seq="createroute" root="/etc/frr" perms="640">conf/r13/script.sh</filetree>
    <exec seq="createroute" type="verbatim" ostype="system">
      chmod +x /etc/frr/script.sh
      /etc/frr/script.sh
    </exec>
  </vm>

  <vm name="gNB" type="lxc" exec_mode="lxc-attach" arch="x86_64">
    <filesystem type="cow">/usr/share/vnx/filesystems/vnx_rootfs_lxc_ubuntu64-22.04-v025-routerwithfrr</filesystem>
    <if net="lo" id="1">
        <ipv6>fcff:14::1/32</ipv6>
    </if>
    <if id="2" net="Net11gnb">
      <ipv6>fcf0:0:11:14::2/64</ipv6>
    </if>
    <if id="3" net="NetgNBh1">
      <ipv6>fd00:0:1::1/64</ipv6>
    </if>
    <if id="4" net="NetgNBh2">
      <ipv6>fd00:0:2::1/64</ipv6>
    </if>
    <if id="5" net="NetgNBh3">
      <ipv6>fd00:0:3::1/64</ipv6>
    </if>
    
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/etc/frr" user="frr" group="frr" perms="640">conf/gNB/*.conf</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
      sysctl -w net.ipv6.conf.all.forwarding=1
      sysctl -w net.ipv6.conf.all.seg6_enabled=1
      for dev in $(ip -o -6 a | awk '{ print $2 }' | grep -v "lo"); do sysctl -w net.ipv6.conf."$dev".seg6_enabled=1; done;
      vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
      vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
    </exec>
    <filetree seq="createroute" root="/etc/frr" perms="640">conf/gNB/script.sh</filetree>
    <exec seq="createroute" type="verbatim" ostype="system">
      chmod +x /etc/frr/script.sh
      /etc/frr/script.sh
    </exec>
  </vm>
</vnx>
