---
apiVersion: v1
kind: ConfigMap
metadata:
  name: srv6-r3-files
  namespace: c9s-srv6
data:
  conf-r3-daemons: |-
    zebra=yes
    bgpd=no
    ospfd=no
    ospf6d=no
    ripd=no
    ripngd=no
    isisd=yes
    pimd=no
    ldpd=no
    nhrpd=no
    eigrpd=no
    babeld=no
    sharpd=no
    staticd=no
    pbrd=no
    bfdd=no
    fabricd=no

    vtysh_enable=yes
    zebra_options=" -s 90000000 --daemon -A 127.0.0.1"
    bgpd_options="   --daemon -A 127.0.0.1"
    ospfd_options="  --daemon -A 127.0.0.1"
    ospf6d_options=" --daemon -A ::1"
    ripd_options="   --daemon -A 127.0.0.1"
    ripngd_options=" --daemon -A ::1"
    isisd_options="  --daemon -A 127.0.0.1"
    pimd_options="  --daemon -A 127.0.0.1"
    ldpd_options="  --daemon -A 127.0.0.1"
    nhrpd_options="  --daemon -A 127.0.0.1"
    eigrpd_options="  --daemon -A 127.0.0.1"
    babeld_options="  --daemon -A 127.0.0.1"
    sharpd_options="  --daemon -A 127.0.0.1"
    staticd_options="  --daemon -A 127.0.0.1"
    pbrd_options="  --daemon -A 127.0.0.1"
    bfdd_options="  --daemon -A 127.0.0.1"
    fabricd_options="  --daemon -A 127.0.0.1"

  conf-r3-isisd.conf: |-
    hostname r3
    password zebra
    !
    interface eth1
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface eth2
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface lo
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    router isis FOO
      net 47.0001.3333.3333.3333.00
      is-type level-2-only
      metric-style wide
    !
    line vty
  conf-r3-zebra.conf: |-
    ! -*- zebra -*-

    !
    hostname r3
    !
    debug zebra events
    debug zebra rib
    !
    interface eth1
     ipv6 address fcf0:0:2:3::2/64
    !
    interface eth2
     ipv6 address fcf0:0:3:4::1/64
    !
    interface eth3.111
     ipv6 address fd00:0:2::/127
    !
    interface eth3.112
     ipv6 address fd00:0:2::2/127
    !
    interface lo
     ipv6 address fcff:3::1/32
    !
    ipv6 forwarding
    !
    line vty
    !
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: srv6-r4-files
  namespace: c9s-srv6
data:
  conf-r4-daemons: |-
    zebra=yes
    bgpd=no
    ospfd=no
    ospf6d=no
    ripd=no
    ripngd=no
    isisd=yes
    pimd=no
    ldpd=no
    nhrpd=no
    eigrpd=no
    babeld=no
    sharpd=no
    staticd=no
    pbrd=no
    bfdd=no
    fabricd=no

    vtysh_enable=yes
    zebra_options=" -s 90000000 --daemon -A 127.0.0.1"
    bgpd_options="   --daemon -A 127.0.0.1"
    ospfd_options="  --daemon -A 127.0.0.1"
    ospf6d_options=" --daemon -A ::1"
    ripd_options="   --daemon -A 127.0.0.1"
    ripngd_options=" --daemon -A ::1"
    isisd_options="  --daemon -A 127.0.0.1"
    pimd_options="  --daemon -A 127.0.0.1"
    ldpd_options="  --daemon -A 127.0.0.1"
    nhrpd_options="  --daemon -A 127.0.0.1"
    eigrpd_options="  --daemon -A 127.0.0.1"
    babeld_options="  --daemon -A 127.0.0.1"
    sharpd_options="  --daemon -A 127.0.0.1"
    staticd_options="  --daemon -A 127.0.0.1"
    pbrd_options="  --daemon -A 127.0.0.1"
    bfdd_options="  --daemon -A 127.0.0.1"
    fabricd_options="  --daemon -A 127.0.0.1"

  conf-r4-isisd.conf: |-
    hostname r4
    password zebra
    !
    interface eth1
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface eth2
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface lo
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    router isis FOO
      net 47.0001.4444.4444.4444.00
      is-type level-2-only
      metric-style wide
    !
    line vty
  conf-r4-zebra.conf: |-
    ! -*- zebra -*-

    !
    hostname r4
    !
    debug zebra events
    debug zebra rib
    !
    interface eth1
     ipv6 address fcf0:0:1:4::2/64
    !
    interface eth2
     ipv6 address fcf0:0:3:4::2/64
    !
    interface lo
     ipv6 address fcff:4::1/32
    !
    ipv6 forwarding
    !
    line vty
    !
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: srv6-r1-files
  namespace: c9s-srv6
data:
  conf-r1-daemons: |-
    zebra=yes
    bgpd=no
    ospfd=no
    ospf6d=no
    ripd=no
    ripngd=no
    isisd=yes
    pimd=no
    ldpd=no
    nhrpd=no
    eigrpd=no
    babeld=no
    sharpd=no
    staticd=no
    pbrd=no
    bfdd=no
    fabricd=no

    vtysh_enable=yes
    zebra_options=" -s 90000000 --daemon -A 127.0.0.1"
    bgpd_options="   --daemon -A 127.0.0.1"
    ospfd_options="  --daemon -A 127.0.0.1"
    ospf6d_options=" --daemon -A ::1"
    ripd_options="   --daemon -A 127.0.0.1"
    ripngd_options=" --daemon -A ::1"
    isisd_options="  --daemon -A 127.0.0.1"
    pimd_options="  --daemon -A 127.0.0.1"
    ldpd_options="  --daemon -A 127.0.0.1"
    nhrpd_options="  --daemon -A 127.0.0.1"
    eigrpd_options="  --daemon -A 127.0.0.1"
    babeld_options="  --daemon -A 127.0.0.1"
    sharpd_options="  --daemon -A 127.0.0.1"
    staticd_options="  --daemon -A 127.0.0.1"
    pbrd_options="  --daemon -A 127.0.0.1"
    bfdd_options="  --daemon -A 127.0.0.1"
    fabricd_options="  --daemon -A 127.0.0.1"

  conf-r1-isisd.conf: |-
    hostname r1
    password zebra
    !
    interface eth1
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface eth2
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface lo
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    router isis FOO
      net 47.0001.1111.1111.1111.00
      is-type level-2-only
      metric-style wide
    !
    line vty
  conf-r1-zebra.conf: |-
    ! -*- zebra -*-

    !
    hostname r1
    !
    debug zebra events
    debug zebra rib
    !
    interface eth1
     ipv6 address fcf0:0:1:2::1/64
    !
    interface eth2
     ipv6 address fcf0:0:1:4::1/64
    !
    interface eth3.111
     ipv6 address fd00:0:1::/127
    !
    interface eth3.112
     ipv6 address fd00:0:1::2/127
    !
    interface lo
     ipv6 address fcff:1::1/32
    !
    ipv6 forwarding
    !
    line vty
    !
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: srv6-r2-files
  namespace: c9s-srv6
data:
  conf-r2-daemons: |-
    zebra=yes
    bgpd=no
    ospfd=no
    ospf6d=no
    ripd=no
    ripngd=no
    isisd=yes
    pimd=no
    ldpd=no
    nhrpd=no
    eigrpd=no
    babeld=no
    sharpd=no
    staticd=no
    pbrd=no
    bfdd=no
    fabricd=no

    vtysh_enable=yes
    zebra_options=" -s 90000000 --daemon -A 127.0.0.1"
    bgpd_options="   --daemon -A 127.0.0.1"
    ospfd_options="  --daemon -A 127.0.0.1"
    ospf6d_options=" --daemon -A ::1"
    ripd_options="   --daemon -A 127.0.0.1"
    ripngd_options=" --daemon -A ::1"
    isisd_options="  --daemon -A 127.0.0.1"
    pimd_options="  --daemon -A 127.0.0.1"
    ldpd_options="  --daemon -A 127.0.0.1"
    nhrpd_options="  --daemon -A 127.0.0.1"
    eigrpd_options="  --daemon -A 127.0.0.1"
    babeld_options="  --daemon -A 127.0.0.1"
    sharpd_options="  --daemon -A 127.0.0.1"
    staticd_options="  --daemon -A 127.0.0.1"
    pbrd_options="  --daemon -A 127.0.0.1"
    bfdd_options="  --daemon -A 127.0.0.1"
    fabricd_options="  --daemon -A 127.0.0.1"

  conf-r2-isisd.conf: |-
    hostname r2
    password zebra
    !
    interface eth1
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface eth2
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    interface lo
     ipv6 router isis FOO
     ip router isis FOO
     isis hello-interval 5
    !
    router isis FOO
      net 47.0001.2222.2222.2222.00
      is-type level-2-only
      metric-style wide
    !
    line vty
  conf-r2-zebra.conf: |-
    ! -*- zebra -*-

    !
    hostname r2
    !
    debug zebra events
    debug zebra rib
    !
    interface eth1
     ipv6 address fcf0:0:1:2::2/64
    !
    interface eth2
     ipv6 address fcf0:0:2:3::1/64
    !
    interface lo
     ipv6 address fcff:2::1/32
    !
    ipv6 forwarding
    !
    line vty
    !
---
apiVersion: clabernetes.containerlab.dev/v1alpha1
kind: Topology
metadata:
  name: srv6
  namespace: c9s-srv6
spec:
  deployment:
    filesFromConfigMap:
        r1:
          - filePath: conf/r1/daemons
            configMapName: srv6-r1-files
            configMapPath: conf-r1-daemons
            mode: read
          - filePath: conf/r1/isisd.conf
            configMapName: srv6-r1-files
            configMapPath: conf-r1-isisd.conf
            mode: read
          - filePath: conf/r1/zebra.conf
            configMapName: srv6-r1-files
            configMapPath: conf-r1-zebra.conf
            mode: execute
        r2:
          - filePath: conf/r2/daemons
            configMapName: srv6-r2-files
            configMapPath: conf-r2-daemons
            mode: read
          - filePath: conf/r2/isisd.conf
            configMapName: srv6-r2-files
            configMapPath: conf-r2-isisd.conf
            mode: read
          - filePath: conf/r2/zebra.conf
            configMapName: srv6-r2-files
            configMapPath: conf-r2-zebra.conf
            mode: execute
        r3:
          - filePath: conf/r3/daemons
            configMapName: srv6-r3-files
            configMapPath: conf-r3-daemons
            mode: read
          - filePath: conf/r3/isisd.conf
            configMapName: srv6-r3-files
            configMapPath: conf-r3-isisd.conf
            mode: read
          - filePath: conf/r3/zebra.conf
            configMapName: srv6-r3-files
            configMapPath: conf-r3-zebra.conf
            mode: execute
        r4:
          - filePath: conf/r4/daemons
            configMapName: srv6-r4-files
            configMapPath: conf-r4-daemons
            mode: read
          - filePath: conf/r4/isisd.conf
            configMapName: srv6-r4-files
            configMapPath: conf-r4-isisd.conf
            mode: read
          - filePath: conf/r4/zebra.conf
            configMapName: srv6-r4-files
            configMapPath: conf-r4-zebra.conf
            mode: execute
  naming: non-prefixed
  definition:
    containerlab: |-
          name: srv6

          topology:
            nodes:
              r1:
                kind: linux
                image: avillaseca01/srv6-frr
                binds:
                  - conf/r1/daemons:/etc/frr/daemons
                  - conf/r1/isisd.conf:/etc/frr/isisd.conf
                  - conf/r1/zebra.conf:/etc/frr/zebra.conf
                exec:
                  - service frr start
                  - sysctl -p
                  - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
                  - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
                  - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
                  - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
                  - ip link add link eth3 name eth3.111 type vlan id 111
                  - ip link add link eth3 name eth3.112 type vlan id 112
                  - ip link set dev eth1 mtu 1200
                  - ip link set dev eth2 mtu 1200
                  - ip link set dev eth3 mtu 1200
                  - ip link set dev eth3.111 mtu 1200
                  - ip link set dev eth3.112 mtu 1200
                  - ip -6 addr add fd00:0:1::/127 dev eth3.111
                  - ip -6 addr add fd00:0:1::2/127 dev eth3.112
                  - ip link set eth1 up
                  - ip link set eth2 up
                  - ip link set eth3 up
                  - ip link set eth3.111 up
                  - ip link set eth3.112 up

                
              r2:
                kind: linux
                image: avillaseca01/srv6-frr
                binds:
                  - conf/r2/daemons:/etc/frr/daemons
                  - conf/r2/isisd.conf:/etc/frr/isisd.conf
                  - conf/r2/zebra.conf:/etc/frr/zebra.conf
                exec:
                  - service frr start
                  - sysctl -p
                  - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
                  - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
                  - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
                  - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
                  - ip link set dev eth1 mtu 1200
                  - ip link set dev eth2 mtu 1200
                  - ip link set eth1 up
                  - ip link set eth2 up

              r3:
                kind: linux
                image: avillaseca01/srv6-frr
                binds:
                  - conf/r3/daemons:/etc/frr/daemons
                  - conf/r3/isisd.conf:/etc/frr/isisd.conf
                  - conf/r3/zebra.conf:/etc/frr/zebra.conf
                exec:
                  - service frr start
                  - sysctl -p
                  - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
                  - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
                  - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
                  - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
                  - ip link add link eth3 name eth3.111 type vlan id 111
                  - ip link add link eth3 name eth3.112 type vlan id 112
                  - ip -6 addr add fd00:0:2::/127 dev eth3.111
                  - ip -6 addr add fd00:0:2::2/127 dev eth3.112
                  - ip link set dev eth1 mtu 1200
                  - ip link set dev eth2 mtu 1200
                  - ip link set dev eth3 mtu 1200
                  - ip link set dev eth3.111 mtu 1200
                  - ip link set dev eth3.112 mtu 1200
                  - ip link set eth1 up
                  - ip link set eth2 up
                  - ip link set eth3 up
                  - ip link set eth3.111 up
                  - ip link set eth3.112 up

              r4:
                kind: linux
                image: avillaseca01/srv6-frr
                binds:
                  - conf/r4/daemons:/etc/frr/daemons
                  - conf/r4/isisd.conf:/etc/frr/isisd.conf
                  - conf/r4/zebra.conf:/etc/frr/zebra.conf
                exec:
                  - service frr start
                  - sysctl -p
                  - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
                  - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
                  - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
                  - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
                  - ip link ser dev eth1 mtu 1200
                  - ip link set dev eth2 mtu 1200
                  - ip link set eth1 up
                  - ip link set eth2 up

                  
              h1:
                kind: linux
                image: praqma/network-multitool:latest
                exec:
                  - ip link add link eth1 name eth1.111 type vlan id 111
                  - ip link add link eth1 name eth1.112 type vlan id 112
                  - ip -6 addr add fd00:0:1::1/127 dev eth1.111
                  - ip -6 addr add fd00:0:1::3/127 dev eth1.112
                  - ip -6 route add fd00:0:2::1/127 via fd00:0:1::0
                  - ip -6 route add fd00:0:2::3/127 via fd00:0:1::2
                  - ip link set dev eth1 mtu 1200
                  - ip link set dev eth1.111 mtu 1200
                  - ip link set dev eth1.112 mtu 1200
                  - ip link set eth1 up
                  - ip link set eth1.111 up
                  - ip link set eth1.112 up
              
              h2:
                kind: linux
                image: praqma/network-multitool:latest
                exec:
                  - ip link add link eth1 name eth1.111 type vlan id 111
                  - ip link add link eth1 name eth1.112 type vlan id 112
                  - ip -6 addr add fd00:0:2::1/127 dev eth1.111
                  - ip -6 addr add fd00:0:2::3/127 dev eth1.112
                  - ip -6 route add fd00:0:1::1/127 via fd00:0:2::0
                  - ip -6 route add fd00:0:1::3/127 via fd00:0:2::2
                  - ip link set dev eth1 mtu 1200
                  - ip link set dev eth1.111 mtu 1200
                  - ip link set dev eth1.112 mtu 1200
                  - ip link set eth1 up
                  - ip link set eth1.111 up
                  - ip link set eth1.112 up