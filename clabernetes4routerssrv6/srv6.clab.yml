name: srv6

topology:
  nodes:
    r1:
      kind: linux
      image: avillaseca01/srv6-frr
      binds:
        - conf/r1/daemons:/etc/frr/daemons
        - conf/r1/isisd.conf:/etc/frr/isisd.conf
        - conf/r1/zebra.conf:/etc/frr/zebra.conf
      exec:
        - service frr start
        - sysctl -p
        - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
        - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
        - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
        - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
        - ip link add link eth3 name eth3.111 type vlan id 111
        - ip link add link eth3 name eth3.112 type vlan id 112
        - ip link set dev eth1 mtu 1500
        - ip link set dev eth2 mtu 1500
        - ip link set dev eth3 mtu 1500
        - ip link set dev eth3.111 mtu 1500
        - ip link set dev eth3.112 mtu 1500
        - ip -6 addr add fd00:0:1::/127 dev eth3.111
        - ip -6 addr add fd00:0:1::2/127 dev eth3.112
        - ip link set eth1 up
        - ip link set eth2 up
        - ip link set eth3 up
        - ip link set eth3.111 up
        - ip link set eth3.112 up

      
    r2:
      kind: linux
      image: avillaseca01/srv6-frr
      binds:
        - conf/r2/daemons:/etc/frr/daemons
        - conf/r2/isisd.conf:/etc/frr/isisd.conf
        - conf/r2/zebra.conf:/etc/frr/zebra.conf
      exec:
        - service frr start
        - sysctl -p
        - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
        - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
        - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
        - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
        - ip link set dev eth1 mtu 1500
        - ip link set dev eth2 mtu 1500
        - ip link set eth1 up
        - ip link set eth2 up

    r3:
      kind: linux
      image: avillaseca01/srv6-frr
      binds:
        - conf/r3/daemons:/etc/frr/daemons
        - conf/r3/isisd.conf:/etc/frr/isisd.conf
        - conf/r3/zebra.conf:/etc/frr/zebra.conf
      exec:
        - service frr start
        - sysctl -p
        - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
        - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
        - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
        - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
        - ip link add link eth3 name eth3.111 type vlan id 111
        - ip link add link eth3 name eth3.112 type vlan id 112
        - ip -6 addr add fd00:0:2::/127 dev eth3.111
        - ip -6 addr add fd00:0:2::2/127 dev eth3.112
        - ip link set dev eth1 mtu 1500
        - ip link set dev eth2 mtu 1500
        - ip link set dev eth3 mtu 1500
        - ip link set dev eth3.111 mtu 1500
        - ip link set dev eth3.112 mtu 1500
        - ip link set eth1 up
        - ip link set eth2 up
        - ip link set eth3 up
        - ip link set eth3.111 up
        - ip link set eth3.112 up

    r4:
      kind: linux
      image: avillaseca01/srv6-frr
      binds:
        - conf/r4/daemons:/etc/frr/daemons
        - conf/r4/isisd.conf:/etc/frr/isisd.conf
        - conf/r4/zebra.conf:/etc/frr/zebra.conf
      exec:
        - service frr start
        - sysctl -p
        - vtysh -c 'configure terminal' -f /etc/frr/zebra.conf
        - vtysh -c 'configure terminal' -f /etc/frr/isisd.conf
        - sysctl -w net.ipv6.conf.eth1.seg6_enabled=1
        - sysctl -w net.ipv6.conf.eth2.seg6_enabled=1
        - ip link ser dev eth1 mtu 1500
        - ip link set dev eth2 mtu 1500
        - ip link set eth1 up
        - ip link set eth2 up

        
    h1:
      kind: linux
      image: praqma/network-multitool:latest
      exec:
        - ip link add link eth1 name eth1.111 type vlan id 111
        - ip link add link eth1 name eth1.112 type vlan id 112
        - ip -6 addr add fd00:0:1::1/127 dev eth1.111
        - ip -6 addr add fd00:0:1::3/127 dev eth1.112
        - ip -6 route add fd00:0:2::1/127 via fd00:0:1::0
        - ip -6 route add fd00:0:2::3/127 via fd00:0:1::2
        - ip link set dev eth1 mtu 1500
        - ip link set dev eth1.111 mtu 1500
        - ip link set dev eth1.112 mtu 1500
        - ip link set eth1 up
        - ip link set eth1.111 up
        - ip link set eth1.112 up
    
    h2:
      kind: linux
      image: praqma/network-multitool:latest
      exec:
        - ip link add link eth1 name eth1.111 type vlan id 111
        - ip link add link eth1 name eth1.112 type vlan id 112
        - ip -6 addr add fd00:0:2::1/127 dev eth1.111
        - ip -6 addr add fd00:0:2::3/127 dev eth1.112
        - ip -6 route add fd00:0:1::1/127 via fd00:0:2::0
        - ip -6 route add fd00:0:1::3/127 via fd00:0:2::2
        - ip link set dev eth1 mtu 1500
        - ip link set dev eth1.111 mtu 1500
        - ip link set dev eth1.112 mtu 1500
        - ip link set eth1 up
        - ip link set eth1.111 up
        - ip link set eth1.112 up

  links:
    - endpoints: ["r1:eth1", "multus:net1012"]
    - endpoints: ["r1:eth2", "multus:net1014"]
    - endpoints: ["r2:eth1", "multus:net1012"]
    - endpoints: ["r2:eth2", "multus:net1023"]
    - endpoints: ["r3:eth1", "multus:net1023"]
    - endpoints: ["r1:eth2", "multus:net1014"]
    - endpoints: ["r4:eth1", "multus:net1014"]
    - endpoints: ["r4:eth2", "multus:net1034"]
    - endpoints: ["r3:eth2", "multus:net1034"]
    - endpoints: ["h1:eth1", "multus:net2011"]
    - endpoints: ["r1:eth3", "multus:net2011"]
    - endpoints: ["h2:eth1", "multus:net2032"]
    - endpoints: ["r3:eth3", "multus:net2032"]
